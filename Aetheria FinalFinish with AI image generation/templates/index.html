<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Aetheria</title>
    <link rel="icon" href="/static/images/cards/the_fool.svg"/>
    <link rel="stylesheet" href="/static/style.css"/>
    <base target="_blank">
</head>
<body>
<!-- ç®€åŒ–èƒŒæ™¯ - åªä½¿ç”¨ backtop.png -->
<div class="background-simple">
    <div class="background-overlay"></div>
</div>

<div class="hero">
    <div class="hero-bg"></div>
    <div class="hero-decor">
        <svg class="hero-tree" viewBox="0 0 800 520" aria-hidden="true">
            <g class="wings" transform="translate(400,220)">
                <path class="wing" d="M-220,0 C-330,-10 -340,-120 -200,-140 C-80,-155 -30,-80 0,-40"/>
                <path class="wing" d="M220,0 C330,-10 340,-120 200,-140 C80,-155 30,-80 0,-40"/>
            </g>
            <g transform="translate(360,260)">
                <path class="trunk" d="M40,0 C36,40 20,120 40,180 C60,120 64,40 60,0 Z"/>
            </g>
            <g class="canopy" transform="translate(400,120)">
                <circle cx="-60" cy="-10" r="34"/>
                <circle cx="0" cy="-40" r="48"/>
                <circle cx="60" cy="-12" r="40"/>
                <circle cx="-20" cy="30" r="38"/>
                <circle cx="40" cy="28" r="30"/>
                <circle cx="110" cy="0" r="22"/>
                <circle cx="-110" cy="8" r="26"/>
                <circle cx="10" cy="10" r="28"/>
                <circle cx="-40" cy="-34" r="20"/>
                <circle cx="80" cy="-42" r="18"/>
            </g>
        </svg>

        <div class="floating rock r1"></div>
        <div class="floating orb o1"></div>
        <div class="floating orb o2"></div>
        <div class="floating petal p1"></div>
    </div>
    <header class="hero-header">
        <h1 class="brand">Aetheria</h1>
        <p class="tag">Dreamlike fortune & visual card creation</p>
        <div class="hero-cta">
            <button id="ctaGenerate" class="primary">Generate a Dream Card</button>
            <a class="link" href="/generated">Gallery</a>
        </div>
    </header>
</div>

<main class="container glass">
    <nav class="topnav"><a href="/">Home</a> Â· <a href="/generated">Gallery</a></nav>

    <!-- æ°´æ™¶é€‰æ‹©éƒ¨åˆ† -->
    <section class="crystals">
        <h2>Choose your inspiration crystal</h2>
        <div id="crystalList" class="crystal-horizontal-list">
            <!-- JavaScriptä¼šåœ¨è¿™é‡Œç”Ÿæˆæ°´æ™¶é€‰é¡¹ -->
        </div>
    </section>

    <!-- æ°´æ™¶çƒéƒ¨åˆ† -->
    <section class="crystal-ball-section">
        <h2>The Dreamy Crystal Ball</h2>
        <p class="section-subtitle">Focus on an intention, then choose to generate a visual card from Stable Diffusion
            or a placeholder art.</p>

        <div class="crystal-ball-container">
            <div id="crystalBall" class="ball">
                <div class="glow"></div>
                <div class="inner-sphere">
                    <img src="/static/images/crystal-ball.png" alt="Crystal Ball" class="crystal-ball-img">
                </div>
            </div>
        </div>
    </section>

    <!-- å åœå’Œç”ŸæˆåŒºåŸŸ -->
    <section class="reading-section">
        <h2>Choose a card reading</h2>

        <div class="reading-options">
            <button class="reading-option active" data-reading="single">Single Card</button>
            <button class="reading-option" data-reading="three">Three Card</button>
            <button class="reading-option" data-reading="clear">Clear Card</button>
        </div>

        <div class="generation-area">
            <div class="generation-left">
                <h3>Generate Custom Image</h3>
                <textarea
                        id="promptInput"
                        placeholder="Enter your prompt here..."
                        rows="3"
                        class="prompt-textarea"
                ></textarea>
            </div>

            <div class="generation-right">
                <h3>Generate Card Image</h3>
                <button id="generateBtn" class="generate-main-btn">
                    Generate Mystical Image
                </button>
            </div>
        </div>

        <!-- æç¤ºè¯æ˜¾ç¤ºåŒºåŸŸ -->
        <div class="prompt-display-area">
            <strong>Prompt:</strong>
            <span id="currentPrompt">Your prompt will appear here...</span>
        </div>

        <div id="readingResult" class="cards-grid"></div>

        <!-- ç”Ÿæˆç»“æœé¢„è§ˆ -->
        <div id="generatedPreview" class="generated-preview">
            <div class="preview-placeholder">
                <p>Your generated image will appear here</p>
            </div>
        </div>
    </section>

    <!-- èŠå¤©åŒºåŸŸ -->
    <section class="chat-section">
        <h2>Chat with the Fortune Teller</h2>
        <div id="chatLog" class="chat-log">
            <div class="chat-message bot-message">
                <div class="message-bubble">
                    Welcome to Aetheria! I am your fortune teller. Ask me anything about your future or seek guidance.
                </div>
            </div>
        </div>
        <div id="typingIndicator" class="typing" style="display: none;">The fortune teller is composing...</div>
        <form id="chatForm" class="chat-form">
            <input id="chatInput" placeholder="Ask a question..." autocomplete="off" class="chat-input"/>
            <button type="submit" class="chat-send">Send</button>
        </form>
    </section>
</main>

<!-- è°ƒè¯•æŒ‰é’® -->
<div class="debug-button">
    <button onclick="quickTest()" class="test-button">
        ğŸ§ª Quick Test
    </button>
</div>

<script>
    // å½“å‰é€‰ä¸­çš„æ°´æ™¶
    let selectedCrystal = null;

    // å¿«é€Ÿæµ‹è¯•å‡½æ•°
    function quickTest() {
        console.log('ğŸ” Quick test started...');

        const promptInput = document.getElementById('promptInput');
        const generateBtn = document.getElementById('generateBtn');
        const preview = document.getElementById('generatedPreview');

        console.log('promptInput:', promptInput);
        console.log('generateBtn:', generateBtn);
        console.log('preview:', preview);

        if (promptInput) {
            promptInput.value = "A mystical crystal ball with glowing energy and stars";
            console.log('Set test prompt:', promptInput.value);
            updatePromptDisplay(promptInput.value);
        }

        if (generateBtn) {
            console.log('Generate button is available');
        }

        // æµ‹è¯•åç«¯è¿æ¥
        testBackendConnection();
    }

    // æµ‹è¯•åç«¯è¿æ¥
    async function testBackendConnection() {
        try {
            console.log('ğŸ”— Testing backend connection...');
            const response = await fetch('/api/health');
            if (response.ok) {
                const data = await response.json();
                console.log('âœ… Backend is healthy:', data);
            } else {
                console.error('âŒ Backend health check failed:', response.status);
            }
        } catch (error) {
            console.error('âŒ Backend connection failed:', error);
        }
    }

    // æ¨¡æ‹Ÿå›¾ç‰‡ç”Ÿæˆï¼ˆä»…ç”¨äºæ¼”ç¤ºï¼‰
    function simulateImageGeneration() {
        const preview = document.getElementById('generatedPreview');
        if (preview) {
            preview.innerHTML = `
                <div class="generated-result">
                    <h4>Generated Image (Simulation)</h4>
                    <div class="image-container">
                        <div class="image-placeholder">
                            <img src="/static/images/card-back.png" alt="Generated Image" class="generated-image">
                        </div>
                    </div>
                    <div class="image-info">
                        <p><strong>Prompt:</strong> A mystical crystal ball with glowing energy and stars</p>
                        <p><strong>Style:</strong> Fantasy Art</p>
                        <p><strong>Note:</strong> This is a simulation. Click "Generate Mystical Image" for real generation.</p>
                        <button class="save-image">Save Image</button>
                    </div>
                </div>
            `;
        }
    }

    // æ›´æ–°æç¤ºè¯æ˜¾ç¤º
    function updatePromptDisplay(prompt) {
        const promptDisplay = document.getElementById('currentPrompt');
        if (promptDisplay) {
            promptDisplay.textContent = prompt || 'Your prompt will appear here...';
        }
    }

    // é¡µé¢åŠ è½½ååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
        console.log('DOM loaded - initializing...');

        // åˆå§‹åŒ–æ°´æ™¶é€‰æ‹©
        initializeCrystals();

        // ç»‘å®šäº‹ä»¶
        bindEvents();

        // åˆå§‹åŒ–é˜…è¯»é€‰é¡¹
        initReadingOptions();
    });

    // åˆå§‹åŒ–æ°´æ™¶é€‰æ‹©
    function initializeCrystals() {
        const crystalList = document.getElementById('crystalList');
        if (!crystalList) return;

        const crystals = [
            {name: 'amethyst', color: '#9966CC', emoji: 'ğŸ”®'},
            {name: 'emerald', color: '#50C878', emoji: 'ğŸ’š'},
            {name: 'ruby', color: '#E0115F', emoji: 'â¤ï¸'},
            {name: 'sapphire', color: '#0F52BA', emoji: 'ğŸ’™'},
            {name: 'citrine', color: '#E4D00A', emoji: 'ğŸ’›'}
        ];

        crystalList.innerHTML = crystals.map(crystal => `
            <div class="crystal-item" data-crystal="${crystal.name}">
                <div class="crystal-emoji">${crystal.emoji}</div>
                <div class="crystal-name">${crystal.name}</div>
            </div>
        `).join('');

        // ç»‘å®šæ°´æ™¶ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.crystal-item').forEach(item => {
            item.addEventListener('click', function () {
                selectCrystal(this.dataset.crystal, this);
            });
        });

        // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªæ°´æ™¶
        if (crystals.length > 0) {
            const firstCrystal = document.querySelector('.crystal-item');
            if (firstCrystal) {
                selectCrystal(crystals[0].name, firstCrystal);
            }
        }
    }

    // åˆå§‹åŒ–é˜…è¯»é€‰é¡¹
    function initReadingOptions() {
        const options = document.querySelectorAll('.reading-option');
        options.forEach(option => {
            option.addEventListener('click', function () {
                options.forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');

                // æ ¹æ®é€‰æ‹©çš„é˜…è¯»ç±»å‹ç»˜åˆ¶å¡ç‰‡
                const readingType = this.dataset.reading;
                drawCards(readingType);
            });
        });

        // é»˜è®¤ç»˜åˆ¶å•å¼ å¡ç‰‡
        drawCards('single');
    }

    // é€‰æ‹©æ°´æ™¶
    function selectCrystal(crystalName, element) {
        document.querySelectorAll('.crystal-item').forEach(item => {
            item.classList.remove('selected');
        });
        element.classList.add('selected');
        selectedCrystal = crystalName;
        console.log('Selected crystal:', crystalName);
    }

    // ç»˜åˆ¶å¡ç‰‡
    function drawCards(readingType) {
        const readingResult = document.getElementById('readingResult');
        if (!readingResult) return;

        let cardCount = 1;
        if (readingType === 'three') cardCount = 3;
        if (readingType === 'clear') {
            readingResult.innerHTML = '';
            return;
        }

        // æ¨¡æ‹Ÿå¡ç‰‡æ•°æ®
        const cards = [
            {name: 'The Fool', description: 'New beginnings, innocence, spontaneity'},
            {name: 'The Magician', description: 'Manifestation, resourcefulness, power'},
            {name: 'The High Priestess', description: 'Intuition, unconscious knowledge, divine feminine'},
            {name: 'The Empress', description: 'Femininity, beauty, nature, abundance'},
            {name: 'The Emperor', description: 'Authority, structure, control, fatherhood'}
        ];

        let cardsHTML = '';
        for (let i = 0; i < cardCount; i++) {
            const card = cards[i % cards.length];
            cardsHTML += `
                <div class="card">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="card-symbol">${getCardSymbol(card.name)}</div>
                            <div class="card-title">${card.name}</div>
                            <div class="card-description">${card.description}</div>
                            <button class="generate-from-card" data-prompt="${card.name} tarot card in fantasy style">Generate Image</button>
                        </div>
                        <div class="card-back">
                            <!-- ä½¿ç”¨ç°æœ‰çš„card-back.pngå›¾ç‰‡ -->
                            <div class="card-back-content"></div>
                        </div>
                    </div>
                </div>
            `;
        }

        readingResult.innerHTML = cardsHTML;

        // ç»‘å®šç”Ÿæˆå¡ç‰‡å›¾ç‰‡äº‹ä»¶
        document.querySelectorAll('.generate-from-card').forEach(button => {
            button.addEventListener('click', function () {
                const prompt = this.dataset.prompt;
                document.getElementById('promptInput').value = prompt;
                updatePromptDisplay(prompt);
            });
        });
    }

    // è·å–å¡ç‰‡ç¬¦å·
    function getCardSymbol(cardName) {
        const symbols = {
            'The Fool': 'ğŸƒ',
            'The Magician': 'ğŸª„',
            'The High Priestess': 'ğŸŒ™',
            'The Empress': 'ğŸ‘‘',
            'The Emperor': 'âšœï¸'
        };
        return symbols[cardName] || 'ğŸƒ';
    }

    // ç»‘å®šäº‹ä»¶
    function bindEvents() {
        const generateBtn = document.getElementById('generateBtn');
        const chatForm = document.getElementById('chatForm');
        const ctaGenerate = document.getElementById('ctaGenerate');
        const promptInput = document.getElementById('promptInput');

        if (generateBtn) generateBtn.addEventListener('click', generateImage);
        if (chatForm) chatForm.addEventListener('submit', sendChatMessage);
        if (ctaGenerate) ctaGenerate.addEventListener('click', quickGenerate);

        // å®æ—¶æ›´æ–°æç¤ºè¯æ˜¾ç¤º
        if (promptInput) {
            promptInput.addEventListener('input', function () {
                updatePromptDisplay(this.value);
            });
        }
    }

    // ç”Ÿæˆå›¾ç‰‡ - å®é™…è°ƒç”¨åç«¯API
    async function generateImage() {
        const promptInput = document.getElementById('promptInput');
        const preview = document.getElementById('generatedPreview');
        const generateBtn = document.getElementById('generateBtn');

        if (!promptInput || !preview || !generateBtn) return;

        const prompt = promptInput.value.trim();
        if (!prompt) {
            alert('Please enter a prompt first!');
            return;
        }

        console.log('ğŸ¨ Starting image generation with prompt:', prompt);
        console.log('ğŸ’ Selected crystal:', selectedCrystal);

        // ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
        generateBtn.disabled = true;
        generateBtn.textContent = 'Generating...';

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        showLoadingState(preview, prompt);

        try {
            // è°ƒç”¨åç«¯API
            const response = await fetch('/api/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt: prompt,
                    crystal: selectedCrystal,
                    width: 512,
                    height: 768
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            console.log('ğŸ“¦ API response:', data);

            if (data.success) {
                showGeneratedResult(data, prompt);
            } else {
                showError(`Generation failed: ${data.note || 'Unknown error'}`);
            }

        } catch (error) {
            console.error('âŒ Generation error:', error);
            showError(`Network error: ${error.message}`);
        } finally {
            // é‡æ–°å¯ç”¨æŒ‰é’®
            generateBtn.disabled = false;
            generateBtn.textContent = 'Generate Mystical Image';
        }
    }

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    function showLoadingState(container, prompt) {
        container.innerHTML = `
            <div class="loading">
                <div class="spinner"></div>
                <p>âœ¨ Generating your mystical image...</p>
                <p class="loading-note">This may take a few moments</p>
                <div class="debug-info">
                    <p><strong>Prompt:</strong> "${prompt}"</p>
                    <p><strong>Crystal:</strong> ${selectedCrystal || 'None'}</p>
                    <p><strong>Started:</strong> ${new Date().toLocaleTimeString()}</p>
                </div>
            </div>
        `;
    }

    // æ˜¾ç¤ºç”Ÿæˆç»“æœ
    function showGeneratedResult(data, prompt) {
        const preview = document.getElementById('generatedPreview');

        // æ·»åŠ æ—¶é—´æˆ³ç¡®ä¿å›¾ç‰‡é‡æ–°åŠ è½½
        const timestamp = new Date().getTime();
        const imageUrl = data.image + (data.image.includes('?') ? '&' : '?') + 't=' + timestamp;

        preview.innerHTML = `
            <div class="generated-result">
                <div class="success-header">
                    <h4>âœ¨ Generation Successful! âœ¨</h4>
                    <div class="success-badge">âœ…</div>
                </div>

                <div class="image-container">
                    <div class="generated-image-wrapper">
                        <img src="${imageUrl}" alt="Generated Image" class="generated-image new-image"
                             onerror="this.src='/static/images/card-back.png'">
                        <div class="image-overlay">
                            <span class="overlay-text">NEW</span>
                        </div>
                    </div>
                </div>

                <div class="image-info">
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Prompt:</strong> ${prompt}
                        </div>
                        <div class="info-item">
                            <strong>Crystal:</strong> ${selectedCrystal || 'Default'}
                        </div>
                        <div class="info-item">
                            <strong>Type:</strong> ${data.type || 'PIL Generated'}
                        </div>
                        <div class="info-item">
                            <strong>Time:</strong> ${new Date().toLocaleString()}
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="save-image" onclick="saveImage('${data.image}')">ğŸ’¾ Save to Gallery</button>
                        <button class="generate-again" onclick="generateImage()">ğŸ”„ Generate Again</button>
                        <button class="view-gallery" onclick="window.location.href='/generated'">ğŸ“ View Gallery</button>
                    </div>
                </div>
            </div>
        `;

        // æ·»åŠ æ–°å›¾ç‰‡çš„é«˜äº®æ•ˆæœ
        const newImage = preview.querySelector('.new-image');
        if (newImage) {
            newImage.style.animation = 'highlight 2s ease-in-out';
            setTimeout(() => {
                newImage.style.animation = '';
            }, 2000);
        }

        console.log('ğŸ–¼ï¸ Image displayed successfully');
    }

    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    function showError(message) {
        const preview = document.getElementById('generatedPreview');
        preview.innerHTML = `
            <div class="error-state">
                <div class="error-icon">âŒ</div>
                <h4>Generation Failed</h4>
                <p class="error-message">${message}</p>
                <div class="error-actions">
                    <button class="retry-btn" onclick="generateImage()">ğŸ”„ Retry</button>
                    <button class="debug-btn" onclick="testBackendConnection()">ğŸ› Debug</button>
                    <button class="help-btn" onclick="showHelp()">â“ Help</button>
                </div>
                <div class="error-tips">
                    <p><strong>Tips:</strong></p>
                    <ul>
                        <li>Check your internet connection</li>
                        <li>Try a different prompt</li>
                        <li>Make sure the server is running</li>
                        <li>Check browser console for details (F12)</li>
                    </ul>
                </div>
            </div>
        `;
    }

    // å‘é€èŠå¤©æ¶ˆæ¯
    function sendChatMessage(e) {
        e.preventDefault();
        const chatInput = document.getElementById('chatInput');
        const chatLog = document.getElementById('chatLog');
        const typingIndicator = document.getElementById('typingIndicator');

        if (!chatInput || !chatLog) return;

        const message = chatInput.value.trim();
        if (!message) return;

        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        const userMessage = document.createElement('div');
        userMessage.className = 'chat-message user-message';
        userMessage.innerHTML = `<div class="message-bubble">${message}</div>`;
        chatLog.appendChild(userMessage);

        // æ¸…ç©ºè¾“å…¥æ¡†
        chatInput.value = '';

        // æ˜¾ç¤ºè¾“å…¥æŒ‡ç¤ºå™¨
        if (typingIndicator) {
            typingIndicator.style.display = 'block';
        }

        // æ»šåŠ¨åˆ°åº•éƒ¨
        chatLog.scrollTop = chatLog.scrollHeight;

        // è°ƒç”¨åç«¯èŠå¤©API
        sendChatToAPI(message, chatLog, typingIndicator);
    }

    // è°ƒç”¨åç«¯èŠå¤©API
    async function sendChatToAPI(message, chatLog, typingIndicator) {
        try {
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: message,
                    crystal: selectedCrystal
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            // éšè—è¾“å…¥æŒ‡ç¤ºå™¨
            if (typingIndicator) {
                typingIndicator.style.display = 'none';
            }

            // æ·»åŠ AIå“åº”
            const botMessage = document.createElement('div');
            botMessage.className = 'chat-message bot-message';
            botMessage.innerHTML = `<div class="message-bubble">${data.reply}</div>`;
            chatLog.appendChild(botMessage);

            // æ»šåŠ¨åˆ°åº•éƒ¨
            chatLog.scrollTop = chatLog.scrollHeight;

        } catch (error) {
            console.error('Chat API error:', error);

            // éšè—è¾“å…¥æŒ‡ç¤ºå™¨
            if (typingIndicator) {
                typingIndicator.style.display = 'none';
            }

            // æ·»åŠ é”™è¯¯å“åº”
            const botMessage = document.createElement('div');
            botMessage.className = 'chat-message bot-message';
            botMessage.innerHTML = `<div class="message-bubble">I apologize, but I'm having trouble connecting right now. Please try again later.</div>`;
            chatLog.appendChild(botMessage);

            // æ»šåŠ¨åˆ°åº•éƒ¨
            chatLog.scrollTop = chatLog.scrollHeight;
        }
    }

    // å¿«é€Ÿç”Ÿæˆ
    function quickGenerate() {
        const prompts = [
            "A mystical tarot card with moon and stars",
            "The Fool tarot card in fantasy style",
            "Magician tarot card with glowing symbols",
            "A beautiful High Priestess tarot card",
            "Fantasy crystal ball with magical energy",
            "Mystical crystal with glowing energy",
            "Ancient tarot card with mysterious symbols",
            "Crystal ball vision of the future"
        ];

        const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];
        document.getElementById('promptInput').value = randomPrompt;
        updatePromptDisplay(randomPrompt);

        // è‡ªåŠ¨ç”Ÿæˆå›¾ç‰‡
        setTimeout(() => {
            generateImage();
        }, 500);
    }

    // ä¿å­˜å›¾ç‰‡
    function saveImage(imageUrl) {
        // è¿™é‡Œå¯ä»¥å®ç°ä¿å­˜åˆ°æœ¬åœ°æˆ–æ”¶è—å¤¹çš„åŠŸèƒ½
        console.log('Saving image:', imageUrl);

        // æ¨¡æ‹Ÿä¿å­˜æ“ä½œ
        const link = document.createElement('a');
        link.href = imageUrl;
        link.download = 'aetheria-generated-image.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // æ˜¾ç¤ºä¿å­˜æˆåŠŸæ¶ˆæ¯
        alert('Image saved successfully!');
    }

    // æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
    function showHelp() {
        alert(`Aetheria Image Generation Help:

1. Enter a prompt describing the image you want
2. Select a crystal for inspiration (optional)
3. Click "Generate Mystical Image"
4. Wait for the AI to create your image
5. Save or regenerate as needed

Common prompts that work well:
- "Mystical crystal ball with glowing energy"
- "Fantasy tarot card with moon and stars"
- "Ancient magical symbols"
- "Cosmic vision of the future"`);
    }
</script>

<style>
    /* æ·»åŠ æ–°æ ·å¼ */
    .success-header {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-bottom: 1rem;
    }

    .success-badge {
        font-size: 2rem;
        animation: bounce 1s infinite;
    }

    @keyframes bounce {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-10px);
        }
    }

    @keyframes highlight {
        0% {
            box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
            transform: scale(1);
        }
        50% {
            box-shadow: 0 0 0 20px rgba(255, 215, 0, 0);
            transform: scale(1.05);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(255, 215, 0, 0);
            transform: scale(1);
        }
    }

    .generated-image-wrapper {
        position: relative;
        display: inline-block;
    }

    .image-overlay {
        position: absolute;
        top: 10px;
        right: 10px;
        background: linear-gradient(135deg, #ff6b6b, #ffd93d);
        color: white;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: bold;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.7;
        }
    }

    .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 1rem;
    }

    .info-item {
        padding: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        font-size: 14px;
    }

    .action-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
    }

    .save-image, .generate-again, .view-gallery,
    .retry-btn, .debug-btn, .help-btn {
        padding: 10px 15px;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
    }

    .save-image, .view-gallery {
        background: linear-gradient(135deg, #4ECDC4, #44A08D);
        color: white;
    }

    .generate-again, .retry-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }

    .debug-btn {
        background: linear-gradient(135deg, #ff9800, #ff5722);
        color: white;
    }

    .help-btn {
        background: linear-gradient(135deg, #9c27b0, #673ab7);
        color: white;
    }

    .error-state {
        text-align: center;
        padding: 2rem;
        background: rgba(244, 67, 54, 0.1);
        border-radius: 15px;
        border: 1px solid rgba(244, 67, 54, 0.3);
    }

    .error-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    .error-message {
        color: #f44336;
        margin-bottom: 1.5rem;
        font-size: 16px;
    }

    .error-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 1.5rem;
    }

    .error-tips {
        text-align: left;
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 10px;
        font-size: 14px;
    }

    .error-tips ul {
        margin: 10px 0 0 0;
        padding-left: 20px;
    }

    .error-tips li {
        margin-bottom: 5px;
    }

    .debug-info {
        margin-top: 15px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.05);
        border-radius: 8px;
        font-size: 12px;
        text-align: left;
    }

    .debug-info p {
        margin: 5px 0;
    }
</style>
</body>
</html>